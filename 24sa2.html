<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorca Underground - MRU Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nosifer&family=Roboto+Mono:wght@400;700&display=swap');
        
        body {
            background-color: #050505;
            color: #d1d1d1;
            font-family: 'Roboto Mono', monospace;
        }

        .crime-title {
            font-family: 'Nosifer', cursive;
            color: #ff0000;
            text-shadow: 3px 3px 6px #000;
        }

        .glass-panel {
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid #444;
        }

        .btn-option {
            background: #1a1a1a;
            border: 1px solid #333;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
            padding: 1rem;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .btn-option:hover {
            border-color: #ff0000;
            background: #2a0000;
            transform: translateX(5px);
        }

        .status-danger {
            color: #ff0000;
            text-shadow: 0 0 5px #ff0000;
        }

        #game-container {
            max-width: 700px;
            margin: 1.5rem auto;
            padding: 2rem;
            border-radius: 12px;
        }

        .progress-bar {
            height: 4px;
            background: #222;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: #ff0000;
            transition: width 0.5s ease;
        }

        input[type="text"] {
            background: #111;
            border: 1px solid #ff0000;
            color: white;
            padding: 10px;
            border-radius: 4px;
            outline: none;
            text-align: center;
        }
    </style>
</head>
<body class="p-4">

    <div id="game-container" class="glass-panel shadow-2xl">
        <h1 class="crime-title text-2xl md:text-4xl text-center mb-6">LORCA UNDERGROUND</h1>
        
        <div id="stats-header" class="hidden flex justify-between items-center text-xs md:text-sm mb-2">
            <div>DELINCUENTE: <span id="nombre-display" class="text-white font-bold"></span></div>
            <div>NIVEL: <span id="nivel-text" class="font-bold text-yellow-500">1</span></div>
            <div>VIDAS: <span id="vidas" class="status-danger font-bold">3</span></div>
        </div>
        <div id="progress-container" class="hidden progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>

        <!-- Pantalla de Inicio -->
        <div id="pantalla-inicio" class="text-center">
            <p class="mb-6 text-gray-400">Pablo, la Ciudad del Sol se ha vuelto oscura. La ley te pisa los talones. Solo tu cerebro puede salvarte.</p>
            <div class="flex flex-col gap-4 items-center mb-8">
                <label class="text-red-500 font-bold uppercase tracking-widest text-sm">Introduce tu Alias Criminal:</label>
                <input type="text" id="nombre-input" placeholder="Ej: El Tuerto de Lorca" maxlength="20">
            </div>
            <button onclick="configurarNombre()" class="bg-red-700 hover:bg-red-600 text-white px-10 py-4 rounded uppercase font-bold transition-all">Iniciar Operaci√≥n</button>
        </div>

        <!-- Pantalla de Juego -->
        <div id="pantalla-juego" class="hidden">
            <div id="header-mision" class="mb-4">
                <span id="label-fuerza" class="bg-white text-black px-2 py-1 text-xs font-bold rounded uppercase tracking-tighter"></span>
                <h3 id="tipo-delito" class="inline ml-2 text-red-500 font-bold"></h3>
            </div>
            
            <div id="escenario-img" class="w-full h-32 bg-zinc-900 rounded mb-4 flex items-center justify-center border border-zinc-800 relative overflow-hidden">
                <span id="emoji-escenario" class="text-6xl z-10">üèôÔ∏è</span>
            </div>

            <p id="enunciado" class="text-sm md:text-base mb-6 leading-relaxed text-yellow-100"></p>
            
            <div id="opciones" class="flex flex-col gap-3">
                <!-- Opciones din√°micas -->
            </div>

            <p id="feedback" class="mt-6 p-4 rounded text-sm hidden font-bold"></p>
        </div>

        <!-- Pantalla Final -->
        <div id="pantalla-final" class="hidden text-center">
            <h2 id="resultado-titulo" class="text-4xl md:text-5xl font-bold mb-6"></h2>
            <p id="resultado-desc" class="mb-10 text-lg text-gray-300"></p>
            <button onclick="location.reload()" class="bg-white text-black px-10 py-4 rounded uppercase font-bold hover:bg-gray-200">Volver a las sombras</button>
        </div>
    </div>

    <script>
        let vidas = 3;
        let faseActual = 0;
        let nivelActual = 1;
        let nombreCriminal = "";
        let ultimoDelito = "";

        const consecuenciasMsg = [
            "¬°EMBOSCADA! El piso franco de {nombre} ha sido asaltado. Pierdes 20 fardos de mercanc√≠a y 40.000‚Ç¨.",
            "¬°FUEGO CRUZADO! En la persecuci√≥n, {nombre} ha perdido un veh√≠culo cargado de armas y dos hombres de confianza.",
            "¬°ORDEN DE CAPTURA! Las cuentas bancarias de {nombre} han sido congeladas. Tu organizaci√≥n est√° al borde del colapso."
        ];

        const misiones = [
            // NIVEL 1: SENCILLOS (Directo v=d/t)
            {
                nivel: 1, fuerza: "Polic√≠a Local", tipo: "HURTO",
                enunciado: "Escapas de un estanco en la Calle Corredera. Has corrido 450 metros en 90 segundos. ¬øA qu√© velocidad constante te has movido para que no te viera la patrulla de la esquina?",
                opciones: [
                    { texto: "5 m/s", correcta: true, feedback: "Limpio. 450/90 = 5 m/s." },
                    { texto: "4 m/s", correcta: false, feedback: "Demasiado lento. Una abuela con andador te grab√≥ con el m√≥vil." },
                    { texto: "6 m/s", correcta: false, feedback: "Tus piernas no dan para tanto, te dio un tir√≥n y te pillaron." }
                ],
                emoji: "üö¨"
            },
            {
                nivel: 1, fuerza: "Polic√≠a Nacional", tipo: "ROBO ALMENARA",
                enunciado: "En el parking del Almenara, tu coche de huida va a 15 m/s. Si necesitas llegar a la salida que est√° a 300 metros, ¬øcu√°ntos segundos tardar√°s?",
                opciones: [
                    { texto: "15 segundos", correcta: false, feedback: "Casi. Revisa la divisi√≥n." },
                    { texto: "20 segundos", correcta: true, feedback: "Exacto. 300 / 15 = 20s. ¬°Saliste antes de que cerraran la barrera!" },
                    { texto: "30 segundos", correcta: false, feedback: "Te sobr√≥ tiempo, pero te detuvieron en el sem√°foro." }
                ],
                emoji: "üöó"
            },
            {
                nivel: 1, fuerza: "Polic√≠a Local", tipo: "AMENAZAS",
                enunciado: "Huyes en moto tras un 'aviso' en San Jos√©. Vas a 12 m/s constantes durante medio minuto (30s). ¬øQu√© distancia has puesto entre t√∫ y la escena del crimen?",
                opciones: [
                    { texto: "300 metros", correcta: false, feedback: "Calculaste mal la multiplicaci√≥n." },
                    { texto: "420 metros", correcta: false, feedback: "Te pasaste de frenada." },
                    { texto: "360 metros", correcta: true, feedback: "Correcto. 12 * 30 = 360m. Ya no te ven." }
                ],
                emoji: "üèçÔ∏è"
            },
            {
                nivel: 1, fuerza: "Polic√≠a Nacional", tipo: "SALUD P√öBLICA",
                enunciado: "Un camello de tu banda corre a 4 m/s. La polic√≠a est√° a 200 metros de √©l. ¬øCu√°nto tardar√°n en alcanzarlo si el camello no acelera y ellos van a 6 m/s?",
                opciones: [
                    { texto: "100 segundos", correcta: true, feedback: "S√≠. La diferencia de velocidad es 2 m/s. 200 / 2 = 100s." },
                    { texto: "50 segundos", correcta: false, feedback: "Menos mal que no son tan r√°pidos." },
                    { texto: "200 segundos", correcta: false, feedback: "Ojal√° tardaran tanto..." }
                ],
                emoji: "üíä"
            },

            // NIVEL 2: COMPLICADOS (Velocidad Relativa / Persecuciones)
            {
                nivel: 2, fuerza: "Guardia Civil", tipo: "TR√ÅFICO A-7",
                enunciado: "Tu furg√≥n con material va a 100 km/h (27.7 m/s). Una patrulla sale 500 metros detr√°s de ti a 120 km/h (33.3 m/s). ¬øEn cu√°ntos segundos te alcanzar√°n si no cambias la velocidad?",
                opciones: [
                    { texto: "125 segundos", correcta: false, feedback: "Casi, pero la diferencia es de 5.6 m/s." },
                    { texto: "89.3 segundos", correcta: true, feedback: "Exacto. 500 / 5.6 = 89.3s. ¬°Hay que pisarle m√°s!" },
                    { texto: "150.5 segundos", correcta: false, feedback: "Estar√≠as en el calabozo hace mucho." }
                ],
                emoji: "üöõ"
            },
            {
                nivel: 2, fuerza: "Guardia Civil", tipo: "CARRETERA √ÅGUILAS",
                enunciado: "Dos coches de tu banda vienen de √Åguilas y Lorca (separados 30 km). Uno va a 20 m/s y el otro a 30 m/s. ¬øEn cu√°nto tiempo se encontrar√°n para intercambiar la mercanc√≠a?",
                opciones: [
                    { texto: "300 segundos", correcta: false, feedback: "Calculaste con km, no con metros." },
                    { texto: "600 segundos", correcta: true, feedback: "Bien. 30000m / (20+30)m/s = 600s (10 min)." },
                    { texto: "1000 segundos", correcta: false, feedback: "Llegar√≠ais tarde a la entrega." }
                ],
                emoji: "ü§ù"
            },
            {
                nivel: 2, fuerza: "Guardia Civil", tipo: "DRONES",
                enunciado: "Un dron de la Benem√©rita te sigue desde el aire. El dron recorre 1.8 km en 1 minuto. ¬øA qu√© velocidad en m/s vuela ese bicho para saber si tu moto puede perderlo?",
                opciones: [
                    { texto: "18 m/s", correcta: false, feedback: "Te falt√≥ un cero." },
                    { texto: "30 m/s", correcta: true, feedback: "Correcto. 1800m / 60s = 30 m/s (108 km/h). ¬°Acelera!" },
                    { texto: "45 m/s", correcta: false, feedback: "Es un dron, no un misil." }
                ],
                emoji: "üõ∏"
            },
            {
                nivel: 2, fuerza: "Guardia Civil", tipo: "PANTANO PUENTES",
                enunciado: "Escapas por el camino del pantano. Recorres 2.4 km a una velocidad de 8 m/s. Al mismo tiempo, una patrulla va por otro camino de 3 km a 10 m/s. ¬øQui√©n llega antes al puente de salida?",
                opciones: [
                    { texto: "Llegas t√∫", correcta: false, feedback: "T√∫ tardas 300s, ellos 300s. ¬°Lleg√°is a la vez!" },
                    { texto: "Llegan ellos", correcta: false, feedback: "Empate t√©cnico." },
                    { texto: "Empate (300s)", correcta: true, feedback: "Exacto. 2400/8 = 300s y 3000/10 = 300s. ¬°Tiroteo asegurado!" }
                ],
                emoji: "üåä"
            },

            // NIVEL 3: DIF√çCILES (Conversiones y Retos de tiempo)
            {
                nivel: 3, fuerza: "Ej√©rcito de Tierra", tipo: "ESTADO DE SITIO",
                enunciado: "El Ej√©rcito bloquea Lorca. Un blindado BMR sale de la base a 54 km/h. T√∫ est√°s a 4 km en tu refugio. Si tardas 5 minutos en quemar las pruebas, ¬øllegar√° el blindado antes de que termines?",
                opciones: [
                    { texto: "No, llega en 266s", correcta: true, feedback: "Correcto. 54km/h = 15m/s. 4000/15 = 266s. ¬°Quema r√°pido, te sobran 34s!" },
                    { texto: "S√≠, llega en 240s", correcta: false, feedback: "Tarda un poco m√°s, pero no te relajes." },
                    { texto: "No, llega en 400s", correcta: false, feedback: "Te habr√≠an detenido tomando caf√©." }
                ],
                emoji: "üéñÔ∏è"
            },
            {
                nivel: 3, fuerza: "Ej√©rcito (U.M.E)", tipo: "SABOTAJE",
                enunciado: "Debes cruzar la zona vigilada del Castillo. Si corres a 9 km/h durante 12 minutos, ¬øcu√°ntos metros habr√°s avanzado? Ojo con las unidades.",
                opciones: [
                    { texto: "1800 metros", correcta: true, feedback: "9km/h = 2.5m/s. 2.5 * 720s = 1800m. ¬°Dentro!" },
                    { texto: "1080 metros", correcta: false, feedback: "Error en la conversi√≥n de horas a segundos." },
                    { texto: "2100 metros", correcta: false, feedback: "Te has pasado de optimista." }
                ],
                emoji: "üè∞"
            },
            {
                nivel: 3, fuerza: "Legi√≥n Espa√±ola", tipo: "ASALTO FINAL",
                enunciado: "Un helic√≥ptero vuela a 180 km/h. T√∫ vas en un deportivo a 144 km/h por la carretera de Caravaca. Si el helic√≥ptero est√° a 500 metros detr√°s de ti, ¬øcu√°nto tiempo tienes antes de que te disparen el inhibidor desde arriba?",
                opciones: [
                    { texto: "30 segundos", correcta: false, feedback: "Demasiado poco." },
                    { texto: "50 segundos", correcta: true, feedback: "¬°Bien! Diferencia: 50m/s - 40m/s = 10m/s. 500/10 = 50s." },
                    { texto: "75 segundos", correcta: false, feedback: "Ya estar√≠as bajo custodia." }
                ],
                emoji: "üöÅ"
            },
            {
                nivel: 3, fuerza: "Ej√©rcito de Tierra", tipo: "EXTRACCI√ìN",
                enunciado: "Tu helic√≥ptero de fuga est√° a 10 km. Vuela hacia ti a 200 km/h. T√∫ vas hacia √©l a 100 km/h. ¬øEn qu√© punto exacto (distancia desde tu posici√≥n) os cruzar√©is?",
                opciones: [
                    { texto: "3.33 km", correcta: true, feedback: "Correcto. Velocidad relativa 300km/h. Tard√°is 1/30 h. 100 * (1/30) = 3.33 km." },
                    { texto: "5.00 km", correcta: false, feedback: "Eso ser√≠a si fuerais a la misma velocidad." },
                    { texto: "2.50 km", correcta: false, feedback: "Te has quedado corto en el c√°lculo." }
                ],
                emoji: "üèÅ"
            }
        ];

        function configurarNombre() {
            const input = document.getElementById('nombre-input').value.trim();
            if (input === "") {
                alert("Pablo, dile al delincuente que se ponga un nombre si quiere ser respetado.");
                return;
            }
            nombreCriminal = input;
            document.getElementById('nombre-display').innerText = nombreCriminal;
            
            document.getElementById('pantalla-inicio').classList.add('hidden');
            document.getElementById('stats-header').classList.remove('hidden');
            document.getElementById('progress-container').classList.remove('hidden');
            document.getElementById('pantalla-juego').classList.remove('hidden');
            
            mostrarMision();
        }

        function mostrarMision() {
            if (faseActual >= misiones.length) {
                finalizarJuego(true);
                return;
            }

            const m = misiones[faseActual];
            
            if (m.nivel !== nivelActual) {
                nivelActual = m.nivel;
                document.getElementById('nivel-text').innerText = nivelActual;
            }

            document.getElementById('label-fuerza').innerText = m.fuerza;
            document.getElementById('tipo-delito').innerText = m.tipo;
            document.getElementById('enunciado').innerText = m.enunciado;
            document.getElementById('emoji-escenario').innerText = m.emoji;
            document.getElementById('feedback').classList.add('hidden');
            
            const progreso = (faseActual / misiones.length) * 100;
            document.getElementById('progress-fill').style.width = `${progreso}%`;

            const contenedorOpciones = document.getElementById('opciones');
            contenedorOpciones.innerHTML = '';

            m.opciones.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-option";
                btn.innerText = opt.texto;
                btn.onclick = () => verificarRespuesta(opt, m.tipo);
                contenedorOpciones.appendChild(btn);
            });
        }

        function verificarRespuesta(opcion, tipo) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.innerText = opcion.feedback;
            feedbackEl.classList.remove('hidden');
            
            const todosLosBotones = document.querySelectorAll('.btn-option');
            todosLosBotones.forEach(b => b.disabled = true);

            if (opcion.correcta) {
                feedbackEl.className = "mt-6 p-4 rounded text-sm bg-green-900 text-green-200 border border-green-500 font-bold";
            } else {
                vidas--;
                ultimoDelito = tipo;
                actualizarVidasUI();
                feedbackEl.className = "mt-6 p-4 rounded text-sm bg-red-900 text-red-200 border border-red-500 font-bold";
                if (vidas <= 0) {
                    setTimeout(() => finalizarJuego(false), 2000);
                    return;
                }
            }

            faseActual++;
            setTimeout(() => {
                if (vidas > 0) mostrarMision();
            }, 2500);
        }

        function actualizarVidasUI() {
            document.getElementById('vidas').innerText = vidas;
            const msgTemplate = consecuenciasMsg[2 - vidas];
            const msgFinal = msgTemplate.replace("{nombre}", nombreCriminal);
            
            const aviso = document.createElement('div');
            aviso.className = "fixed inset-0 flex items-center justify-center z-50 p-4";
            aviso.innerHTML = `<div class="bg-red-700 text-white p-6 rounded-lg shadow-2xl border-4 border-black text-center max-w-sm animate-pulse">
                <h4 class="font-black text-xl mb-2">¬°GOLPE A LA MAFIA!</h4>
                <p class="text-sm font-bold">${msgFinal}</p>
            </div>`;
            document.body.appendChild(aviso);
            setTimeout(() => aviso.remove(), 4000);
        }

        function finalizarJuego(ganaste) {
            document.getElementById('pantalla-juego').classList.add('hidden');
            document.getElementById('stats-header').classList.add('hidden');
            document.getElementById('progress-container').classList.add('hidden');
            
            const pantallaFinal = document.getElementById('pantalla-final');
            pantallaFinal.classList.remove('hidden');

            const titulo = document.getElementById('resultado-titulo');
            const desc = document.getElementById('resultado-desc');

            if (ganaste) {
                titulo.innerText = `CAPO ${nombreCriminal.toUpperCase()}`;
                titulo.className = "text-4xl font-bold mb-6 text-green-500";
                desc.innerText = `${nombreCriminal}, Lorca est√° a tus pies. Has humillado al Ej√©rcito y a la Polic√≠a con tu inteligencia. Tu imperio no tiene fin.`;
            } else {
                titulo.innerText = "FIN DE LA PARTIDA";
                titulo.className = "text-4xl font-bold mb-6 text-red-600";
                
                let destino = "";
                if (nivelActual === 3) {
                    destino = `Tras el operativo fallido de ${ultimoDelito}, el Ej√©rcito no tuvo piedad. ${nombreCriminal} ha muerto en un tiroteo cerca del Castillo de Lorca.`;
                } else if (nivelActual === 2) {
                    destino = `La Guardia Civil ha desmantelado la banda. ${nombreCriminal} ha sido condenado a 30 a√±os en la prisi√≥n de Sangonera por narcotr√°fico y banda armada.`;
                } else {
                    destino = `La Polic√≠a Nacional ha capturado a ${nombreCriminal}. Te esperan varios a√±os a la sombra y el decomiso de todo lo que robaste.`;
                }
                desc.innerText = destino;
            }
        }
    </script>
</body>
</html>