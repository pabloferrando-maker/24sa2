<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LORCA: CODICIA Y ASFALTO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&display=swap');
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: #050505;
            color: #e2e8f0;
        }

        .crimson-gradient {
            background: linear-gradient(135deg, #111827 0%, #000000 100%);
            border: 1px solid #1f2937;
        }

        .btn-action {
            background-color: #b91c1c;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #991b1b;
        }

        .btn-action:hover:not(:disabled) {
            background-color: #dc2626;
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(220, 38, 38, 0.5);
        }

        .option-btn {
            background: rgba(17, 24, 39, 0.8);
            border: 1px solid #374151;
            transition: all 0.2s;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .option-btn:hover {
            border-color: #f87171;
            background: rgba(220, 38, 38, 0.1);
        }

        .heart { font-size: 2.5rem; transition: all 0.5s; }
        .lost-heart { filter: grayscale(1) opacity(0.1); transform: scale(0.7); }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.5s ease-out; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-5xl crimson-gradient rounded-3xl overflow-hidden shadow-2xl border-2 border-red-900/30 animate-slide">
        
        <!-- PANTALLA ACCESO -->
        <div id="screen-auth" class="p-12 text-center">
            <h1 class="text-6xl font-black tracking-tighter text-white uppercase italic mb-4">LORCA: <span class="text-red-600">CODICIA Y ASFALTO</span></h1>
            <p class="text-slate-500 mb-10 text-xl max-w-2xl mx-auto leading-relaxed italic">Calcula o termina en Sangonera. AquÃ­ no hay segundas oportunidades.</p>

            <div class="max-w-md mx-auto space-y-8">
                <input type="text" id="alias-input" class="w-full bg-black/60 px-8 py-5 rounded-2xl border-2 border-slate-800 text-white focus:border-red-600 outline-none text-2xl font-bold text-center uppercase" placeholder="TU ALIAS">
                <button onclick="goToLevels()" class="w-full btn-action py-6 rounded-2xl font-black text-white uppercase tracking-[0.4em] text-xl shadow-2xl">ENTRAR AL BARRIO</button>
            </div>
        </div>

        <!-- PANTALLA NIVELES -->
        <div id="screen-levels" class="hidden p-12">
            <div class="flex justify-between items-end mb-12 border-b-2 border-red-900/20 pb-10">
                <h2 class="text-4xl font-black text-white uppercase italic">ELIGE TU PALO</h2>
                <span id="display-alias" class="text-red-600 font-black text-2xl uppercase italic"></span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <button onclick="startLevel(1)" class="option-btn p-10 rounded-[2.5rem] text-left flex flex-col justify-between min-h-[300px]">
                    <h3 class="font-black text-2xl text-white uppercase mb-4">TIRONES</h3>
                    <p class="text-sm text-slate-400 font-normal">Poca monta por la Corredera. Riesgo de calabozo local.</p>
                </button>
                <button onclick="startLevel(2)" class="option-btn p-10 rounded-[2.5rem] text-left flex flex-col justify-between min-h-[300px]">
                    <h3 class="font-black text-2xl text-white uppercase mb-4">VUELCOS</h3>
                    <p class="text-sm text-slate-400 font-normal">MercancÃ­a pesada en los polÃ­gonos. Manteca de la buena.</p>
                </button>
                <button onclick="startLevel(3)" class="option-btn p-10 rounded-[2.5rem] text-left flex flex-col justify-between min-h-[300px]">
                    <h3 class="font-black text-2xl text-white uppercase mb-4">MAFIA</h3>
                    <p class="text-sm text-slate-400 font-normal">Bous por la A-7. Si fallas, vas al hoyo.</p>
                </button>
            </div>
        </div>

        <!-- PANTALLA JUEGO -->
        <div id="screen-game" class="hidden">
            <div class="bg-black/80 px-12 py-8 border-b border-red-900/20 flex justify-between items-center">
                <div id="lives-container" class="flex gap-4"></div>
                <h3 id="question-progress" class="text-xl font-black text-slate-400 uppercase">FASE 01 / 07</h3>
            </div>

            <div class="p-12">
                <div class="bg-slate-900/20 border-2 border-slate-800 rounded-[3rem] p-12 mb-10">
                    <h4 id="crime-title" class="font-black text-white text-3xl uppercase mb-6 italic text-red-600"></h4>
                    <p id="crime-desc" class="text-slate-200 text-2xl leading-relaxed mb-10 font-medium"></p>
                    <div class="bg-black/60 p-10 rounded-3xl border border-red-900/30">
                        <p id="math-problem" class="text-3xl font-bold text-white text-center italic"></p>
                    </div>
                </div>
                <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div>

                <div id="feedback" class="hidden mt-10 p-10 rounded-[2.5rem] border bg-black animate-slide">
                    <p id="feedback-text" class="font-black uppercase text-2xl mb-2"></p>
                    <p id="consequence-text" class="text-xl text-slate-400 italic mb-8"></p>
                    <button id="next-btn" class="w-full bg-red-600 text-white py-6 rounded-2xl font-black text-xl uppercase tracking-widest">CONTINUAR</button>
                </div>
            </div>
        </div>

        <!-- PANTALLA RESULTADOS -->
        <div id="screen-result" class="hidden p-16 text-center">
            <div id="result-visual" class="mb-8 text-8xl"></div>
            <h2 id="result-title" class="text-6xl font-black mb-8 uppercase italic"></h2>
            
            <div id="result-jail-card" class="hidden bg-red-950/10 border-2 border-red-600/30 p-12 rounded-[3rem] mb-14 text-left max-w-xl mx-auto">
                <div class="border-b-2 border-red-900/20 pb-4 mb-6">
                    <h4 class="text-red-600 font-black text-xs uppercase tracking-widest">FICHA POLICIAL - DESTINO SANGONERA</h4>
                </div>
                <div class="space-y-6 text-xl">
                    <p><span class="text-slate-500 uppercase text-sm">CONDENA:</span> <br><span id="jail-time" class="font-black text-white text-4xl"></span></p>
                    <p><span class="text-slate-500 uppercase text-sm">CARGOS ACUMULADOS:</span> <br><span id="jail-reason" class="text-slate-200"></span></p>
                </div>
            </div>

            <div id="success-card" class="hidden bg-green-950/10 border-2 border-green-600/30 p-12 rounded-[3rem] mb-14 text-center max-w-xl mx-auto">
                <h4 class="text-green-500 font-black mb-4 uppercase">OPERACIÃ“N CORONADA</h4>
                <p id="secret-code" class="text-5xl font-black text-white tracking-widest"></p>
            </div>
            
            <button onclick="location.reload()" class="bg-white text-black px-16 py-6 rounded-2xl font-black uppercase text-xl hover:bg-red-600 hover:text-white transition-all">OTRA OPORTUNIDAD</button>
        </div>
    </div>

    <script>
        const state = {
            alias: '',
            lives: 3,
            currentLevel: 1,
            questionIndex: 1,
            failures: [],
            currentAns: 0
        };

        const badNews = [
            "Â¡CANTADA TOTAL! Han trincado al 'Chole' y ha soltado el nombre de tu primo.",
            "Â¡MALDITA SEA! Has tenido que tirar 20 kg de hachÃ­s al GuadalentÃ­n para que no te pillen.",
            "Â¡BOOM! Han reventado la rueda del BMW y te ha tocado seguir a pie. Pierdes tiempo.",
            "Â¡OJO! El 'Gominas' estÃ¡ en el suelo con un balazo en el hombro. Lo han encerrado.",
            "Â¡FALLO CRÃTICO! La poli ha precintado el almacÃ©n de Purias con todo el gÃ©nero dentro.",
            "Â¡CRIMEN! Te han grabado la matrÃ­cula en la rotonda de San CristÃ³bal. EstÃ¡s fichado.",
            "Â¡DESASTRE! Has perdido la riÃ±onera con los 5000 pavos del adelanto en la huida."
        ];

        function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

        function generateQuestion() {
            let data = {};
            const lvl = state.currentLevel;

            if (lvl === 1) {
                // NIVEL 1: CINEMÃTICA BÃSICA (v = d/t)
                const type = Math.random() > 0.5 ? 'v' : 't';
                const dist = Math.floor(Math.random() * 100) + 100;
                if (type === 'v') {
                    const time = Math.floor(Math.random() * 10) + 10;
                    data = {
                        t: "TIRÃ“N EN LAS ALAMEDAS",
                        d: `Acabas de dar un tirÃ³n. El callejÃ³n seguro estÃ¡ a ${dist} metros. La pasma llega en ${time} segundos.`,
                        p: "Â¿A quÃ© velocidad mÃ­nima (m/s) tienes que correr para que no te huelan?",
                        ans: (dist / time).toFixed(1),
                        unit: "m/s"
                    };
                } else {
                    const vel = Math.floor(Math.random() * 5) + 5;
                    data = {
                        t: "ROBO EN LA CORREDERA",
                        d: `Has reventado un escaparate. La salida estÃ¡ a ${dist} metros. Vas a tope a ${vel} m/s.`,
                        p: "Â¿En cuÃ¡ntos segundos (t) llegarÃ¡s al punto de escape?",
                        ans: (dist / vel).toFixed(1),
                        unit: "s"
                    };
                }
            } else if (lvl === 2) {
                // NIVEL 2: MRU (x = x0 + v*t)
                const type = Math.floor(Math.random() * 3); // 0: x, 1: v, 2: x0
                const x0 = Math.floor(Math.random() * 50) + 10;
                const v = Math.floor(Math.random() * 40) + 60;
                const t = Math.floor(Math.random() * 3) + 2;
                const x = x0 + v * t;

                if (type === 0) {
                    data = {
                        t: "VUELCO EN SAPRELORCA",
                        d: `Sales del polÃ­gono en la posiciÃ³n KM ${x0}. Vas a ${v} KM/H constantes. El tiempo de viaje es de ${t} horas.`,
                        p: "Â¿En quÃ© punto kilomÃ©trico (x) estarÃ¡s para la descarga?",
                        ans: x.toString(),
                        unit: "KM"
                    };
                } else if (type === 1) {
                    data = {
                        t: "NARCO-RUTA POR LA HUERTA",
                        d: `Sales de la caleta en el KM ${x0}. Debes llegar al KM ${x} en exactamente ${t} horas sin fallar.`,
                        p: "Â¿A quÃ© velocidad constante (v) KM/H tienes que llevar el camiÃ³n?",
                        ans: v.toString(),
                        unit: "KM/H"
                    };
                } else {
                    data = {
                        t: "MERCANCÃA DE CONTRABANDO",
                        d: `Tras ${t} horas de viaje a ${v} KM/H, te han parado en un control en el KM ${x}.`,
                        p: "Â¿Desde quÃ© punto kilomÃ©trico (x0) saliste originalmente?",
                        ans: x0.toString(),
                        unit: "KM"
                    };
                }
            } else {
                // NIVEL 3: ENCUENTROS/ALCANCES (t = d / (v1+v2) o t = d / (v2-v1))
                const type = Math.random() > 0.5 ? 'encuentro' : 'alcance';
                const dist = Math.floor(Math.random() * 1000) + 500;
                const v1 = Math.floor(Math.random() * 10) + 20;
                const v2 = Math.floor(Math.random() * 10) + 35;

                if (type === 'encuentro') {
                    data = {
                        t: "AJUSTE EN SAN CRISTÃ“BAL",
                        d: `Vuestra banda y los rivales estÃ¡is a ${dist} metros. Vosotros vais a ${v1} m/s y ellos vienen a ${v2} m/s hacia vosotros.`,
                        p: "Â¿En quÃ© segundo (t) os verÃ©is las caras en mitad de la calle?",
                        ans: (dist / (v1 + v2)).toFixed(1),
                        unit: "s"
                    };
                } else {
                    data = {
                        t: "BOU POR LA A-7",
                        d: `Los picolos estÃ¡n a ${dist} metros detrÃ¡s de vosotros. Ellos van a ${v2} m/s y vosotros a ${v1} m/s (vais lentos).`,
                        p: "Â¿En cuÃ¡ntos segundos (t) os darÃ¡n el primer viaje por detrÃ¡s?",
                        ans: (dist / (v2 - v1)).toFixed(1),
                        unit: "s"
                    };
                }
            }
            return data;
        }

        function goToLevels() {
            state.alias = document.getElementById('alias-input').value.trim() || "ANÃ“NIMO";
            document.getElementById('display-alias').innerText = state.alias;
            showScreen('screen-levels');
        }

        function startLevel(l) {
            state.currentLevel = l;
            state.questionIndex = 1;
            state.lives = 3;
            state.failures = [];
            showScreen('screen-game');
            updateLives();
            loadQuestion();
        }

        function updateLives() {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            for(let i=0; i<3; i++) {
                container.innerHTML += `<span class="heart ${i < state.lives ? 'text-red-600' : 'lost-heart'}">âš¡</span>`;
            }
        }

        function loadQuestion() {
            document.getElementById('feedback').classList.add('hidden');
            const data = generateQuestion();
            state.currentAns = data.ans;

            document.getElementById('question-progress').innerText = `MOVIMIENTO 0${state.questionIndex} / 07`;
            document.getElementById('crime-title').innerText = data.t;
            document.getElementById('crime-desc').innerText = data.d;
            document.getElementById('math-problem').innerText = data.p;

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            const opts = shuffle([
                data.ans, 
                (parseFloat(data.ans) + (Math.random()*5 + 1)).toFixed(1), 
                (parseFloat(data.ans) - (Math.random()*3 + 1)).toFixed(1),
                (parseFloat(data.ans) * 1.5).toFixed(1)
            ]);
            
            opts.forEach(o => {
                const b = document.createElement('button');
                b.className = "option-btn py-8 px-6 rounded-3xl border-b-8 border-slate-900 text-white shadow-xl";
                b.innerText = `${o} ${data.unit}`;
                b.onclick = () => check(o);
                grid.appendChild(b);
            });
        }

        function check(val) {
            const fb = document.getElementById('feedback');
            const fbt = document.getElementById('feedback-text');
            const cst = document.getElementById('consequence-text');
            fb.classList.remove('hidden');

            if(val == state.currentAns) {
                fbt.innerText = "Â¡LIMPIO, PRIMO!";
                fbt.className = "font-black text-green-500 text-3xl mb-2";
                cst.innerText = "OperaciÃ³n impecable. Seguimos moviendo el gÃ©nero.";
            } else {
                state.lives--;
                updateLives();
                const randomBad = badNews[Math.floor(Math.random() * badNews.length)];
                state.failures.push("Delito de banda organizada");
                
                fbt.innerText = "Â¡LA HAS CAGADO!";
                fbt.className = "font-black text-red-600 text-3xl mb-2";
                cst.innerText = randomBad;
                
                if(state.lives <= 0) {
                    document.getElementById('next-btn').onclick = () => finish(false);
                    return;
                }
            }
            document.getElementById('next-btn').onclick = () => {
                state.questionIndex++;
                if(state.questionIndex > 7) finish(true);
                else loadQuestion();
            };
        }

        function finish(win) {
            showScreen('screen-result');
            const jail = document.getElementById('result-jail-card');
            const succ = document.getElementById('success-card');
            if(win) {
                document.getElementById('result-visual').innerText = "ðŸ¤´";
                document.getElementById('result-title').innerText = "EL CAPO DE LORCA";
                document.getElementById('result-title').className = "text-6xl font-black mb-8 uppercase italic text-green-500";
                succ.classList.remove('hidden');
                document.getElementById('secret-code').innerText = "BOSS-" + Math.random().toString(36).substring(7).toUpperCase();
            } else {
                document.getElementById('result-visual').innerText = "ðŸš”";
                document.getElementById('result-title').innerText = "A SANGONERA";
                document.getElementById('result-title').className = "text-6xl font-black mb-8 uppercase italic text-red-600";
                jail.classList.remove('hidden');
                document.getElementById('jail-time').innerText = (state.currentLevel * 7) + " AÃ‘OS";
                document.getElementById('jail-reason').innerText = "Pertenencia a organizaciÃ³n criminal, resistencia, trÃ¡fico y daÃ±os.";
            }
        }

        function showScreen(id) {
            ['screen-auth', 'screen-levels', 'screen-game', 'screen-result'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }
    </script>
</body>
</html>
