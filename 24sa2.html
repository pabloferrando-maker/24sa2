<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inframundo F√≠sico: Operativos de √âlite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&display=swap');
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: #020617;
            color: #e2e8f0;
        }

        .crimson-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
        }

        .btn-action {
            background-color: #991b1b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #7f1d1d;
        }

        .btn-action:hover:not(:disabled) {
            background-color: #b91c1c;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(185, 28, 28, 0.4);
        }

        .option-btn {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #475569;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: #ef4444;
            background: rgba(153, 27, 27, 0.1);
        }

        .heart { font-size: 1.5rem; transition: all 0.5s; }
        .lost-heart { filter: grayscale(1) opacity(0.2); transform: scale(0.8); }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.4s ease-out; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-3xl crimson-gradient rounded-2xl overflow-hidden shadow-2xl animate-slide">
        
        <!-- PANTALLA 1: ACCESO AL INFRAMUNDO -->
        <div id="screen-auth" class="p-10 text-center">
            <div class="mb-8">
                <div class="w-20 h-20 bg-red-900/20 border border-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 00-2 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h1 class="text-3xl font-bold tracking-tighter text-white uppercase">Red de Operaciones Oscuras</h1>
                <p class="text-slate-400 mt-2 text-sm italic font-light">Calcula o s√© capturado. La f√≠sica no perdona errores.</p>
            </div>

            <div class="max-w-sm mx-auto space-y-6">
                <div class="text-left">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2 ml-1">Alias del Operador</label>
                    <input type="text" id="alias-input" class="w-full bg-slate-900/50 px-5 py-4 rounded-xl border border-slate-700 text-white focus:ring-2 focus:ring-red-600 outline-none transition-all uppercase font-bold tracking-widest" placeholder="EJ: V_SIN_STRICT">
                </div>
                <button onclick="goToLevels()" class="w-full btn-action py-4 rounded-xl font-bold text-white uppercase tracking-widest shadow-lg">Entrar en la Red</button>
            </div>
        </div>

        <!-- PANTALLA 2: SELECTOR DE OPERATIVOS -->
        <div id="screen-levels" class="hidden p-10">
            <div class="flex justify-between items-end mb-10 border-b border-slate-700 pb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white uppercase tracking-tight">Contratos Disponibles</h2>
                    <p class="text-slate-500 text-xs">Filtre misiones por nivel de riesgo</p>
                </div>
                <div class="text-right">
                    <span id="display-alias" class="block text-red-500 font-bold text-sm uppercase"></span>
                    <span class="text-[10px] text-slate-600 uppercase">Estado: Encriptado</span>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-5">
                <button onclick="startLevel(1)" class="option-btn p-6 rounded-2xl text-left group">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg text-slate-100 uppercase group-hover:text-red-500 transition-colors">Nivel I: Hurtos Callejeros</h3>
                            <p class="text-xs text-slate-400 mt-1 leading-relaxed max-w-md">Problemas de MRU simple. Escapes a pie y en moto tras robos menores.</p>
                        </div>
                        <span class="bg-slate-700 text-slate-300 text-[10px] px-2 py-1 rounded">RIESGO: BAJO</span>
                    </div>
                </button>

                <button onclick="startLevel(2)" class="option-btn p-6 rounded-2xl text-left group">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg text-slate-100 uppercase group-hover:text-red-500 transition-colors">Nivel II: Tr√°fico y Asaltos</h3>
                            <p class="text-xs text-slate-400 mt-1 leading-relaxed max-w-md">Problemas de posici√≥n inicial ($x_0$) y tiempo. Narcotr√°fico y robos a blindados.</p>
                        </div>
                        <span class="bg-orange-900/30 text-orange-400 text-[10px] px-2 py-1 rounded">RIESGO: MEDIO</span>
                    </div>
                </button>

                <button onclick="startLevel(3)" class="option-btn p-6 rounded-2xl text-left group">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg text-slate-100 uppercase group-hover:text-red-500 transition-colors">Nivel III: Crimen Organizado</h3>
                            <p class="text-xs text-slate-400 mt-1 leading-relaxed max-w-md">Encuentros de m√≥viles y persecuciones extremas entre bandas rivales.</p>
                        </div>
                        <span class="bg-red-900/30 text-red-500 text-[10px] px-2 py-1 rounded border border-red-900/50">RIESGO: EXTREMO</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- PANTALLA 3: PANEL DE MISI√ìN -->
        <div id="screen-game" class="hidden">
            <div class="bg-slate-900/80 px-10 py-5 border-b border-slate-700 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div id="lives-container" class="flex gap-2"></div>
                    <div class="h-8 w-[1px] bg-slate-700 mx-2"></div>
                    <div>
                        <span id="level-label" class="text-[10px] font-bold text-red-500 uppercase tracking-widest block mb-0.5">NIVEL</span>
                        <h3 id="question-progress" class="text-xs font-bold text-slate-300 uppercase">Misi√≥n 1 / 7</h3>
                    </div>
                </div>
            </div>

            <div class="p-10">
                <div class="bg-slate-800/40 border border-slate-700 rounded-2xl p-8 mb-8 relative overflow-hidden">
                    <div class="relative z-10">
                        <h4 id="crime-title" class="font-bold text-red-500 uppercase text-xs mb-3 tracking-widest border-l-2 border-red-500 pl-3 uppercase">Intercepci√≥n en curso</h4>
                        <p id="crime-desc" class="text-slate-300 text-sm leading-relaxed mb-6 font-light italic"></p>
                        <div class="bg-slate-950 p-6 rounded-xl border border-slate-800 shadow-inner">
                            <p id="math-problem" class="text-lg font-bold text-white text-center"></p>
                        </div>
                    </div>
                </div>

                <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>

                <div id="feedback" class="hidden mt-8 p-6 rounded-2xl border bg-slate-950 animate-slide">
                    <div class="flex items-start gap-4">
                        <div id="feedback-icon" class="text-2xl"></div>
                        <div class="flex-1">
                            <p id="feedback-text" class="font-bold uppercase tracking-wider text-sm"></p>
                            <p id="consequence-text" class="text-xs mt-2 text-slate-400 leading-normal"></p>
                        </div>
                    </div>
                    <button id="next-btn" onclick="nextStep()" class="mt-6 w-full bg-white text-black py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-slate-200 transition-colors">Continuar</button>
                </div>
            </div>
        </div>

        <!-- PANTALLA 4: RESULTADO -->
        <div id="screen-result" class="hidden p-12 text-center">
            <div id="result-visual" class="mb-10 text-6xl"></div>
            <h2 id="result-title" class="text-4xl font-black mb-4 uppercase tracking-tighter"></h2>
            <p id="result-desc" class="text-slate-400 mb-10 max-w-md mx-auto leading-relaxed"></p>
            
            <div id="result-jail-card" class="hidden bg-slate-950 border border-red-900/40 p-8 rounded-3xl mb-10 text-left max-w-md mx-auto">
                <div class="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                    <h4 class="text-red-500 font-bold uppercase text-[10px] tracking-widest">EXPEDIENTE DE CONDENA</h4>
                    <span class="text-[9px] text-slate-600">RECLUSO: <span id="recluso-id"></span></span>
                </div>
                <div class="space-y-4">
                    <div>
                        <span class="text-slate-500 text-[9px] uppercase block mb-1">Pena de Prisi√≥n:</span>
                        <span id="jail-time" class="text-xl font-bold text-white tracking-tight"></span>
                    </div>
                    <div>
                        <span class="text-slate-500 text-[9px] uppercase block mb-1">M√≥dulo Carcelario:</span>
                        <span id="jail-destination" class="text-md text-red-200 font-semibold"></span>
                    </div>
                    <div class="p-3 bg-red-900/10 rounded-lg border border-red-900/20">
                        <span class="text-red-500 text-[9px] uppercase block mb-1 font-bold">Resumen de Delitos:</span>
                        <span id="jail-reason" class="text-[11px] text-slate-300 italic leading-tight block"></span>
                    </div>
                </div>
            </div>

            <div id="success-card" class="hidden bg-slate-950 border border-green-900/40 p-8 rounded-3xl mb-10 text-left max-w-md mx-auto">
                <div class="text-center">
                    <h4 class="text-green-500 font-bold uppercase text-xs tracking-widest mb-4">ACCESO TOTAL CONCEDIDO</h4>
                    <div class="bg-green-900/20 p-4 rounded-xl border border-green-900/30 mb-4">
                        <span class="text-slate-500 text-[10px] uppercase block mb-2">C√≥digo Maestro:</span>
                        <span id="secret-code" class="text-2xl font-black text-white tracking-[0.5em]"></span>
                    </div>
                    <p class="text-[10px] text-slate-500 italic">Este c√≥digo te permite blanquear activos en el mercado negro.</p>
                </div>
            </div>
            
            <button onclick="location.reload()" class="bg-slate-800 text-white px-10 py-4 rounded-2xl font-bold uppercase tracking-widest hover:bg-slate-700 transition-all text-xs">Cerrar Sesi√≥n</button>
        </div>

    </div>

    <script>
        const state = {
            alias: '',
            lives: 3,
            currentLevel: 1,
            questionIndex: 1,
            maxQuestions: 7,
            isAnswering: false,
            usedScenarioIndices: []
        };

        const scenarioGen = {
            1: [
                { t: "Robo en Joyer√≠a", d: "Acabas de reventar el escaparate de una joyer√≠a en la calle principal. Tienes que recorrer {dist} metros por la acera antes de que la patrulla de la esquina te vea. El cron√≥metro marca que tienes {time} segundos.", p: "¬øA qu√© velocidad constante (v) debes correr para llegar al callej√≥n de escape?" },
                { t: "Escape en Metro", d: "Has robado un bolso de lujo y el guarda te persigue. Debes llegar a la entrada del metro que est√° a {dist} metros. El guarda alcanzar√° esa posici√≥n en {time} segundos.", p: "¬øQu√© velocidad m√≠nima necesitas para bajar las escaleras antes que √©l?" },
                { t: "El Soplo", d: "Te han avisado de que la polic√≠a viene de camino. Tienes que mover tu mercanc√≠a {dist} metros hasta el almac√©n vecino. Tienes exactamente {time} segundos antes de que rodeen el edificio.", p: "¬øA qu√© velocidad (v) en m/s debes moverte para salvar el material?" }
            ],
            2: [
                { t: "Entrega de Narc√≥ticos", d: "Tu cami√≥n con 500kg de estupefacientes sali√≥ del punto de control en el km {x0}. Viajas por la nacional a {v} km/h constantes evitando radares.", p: "¬øEn qu√© punto kilom√©trico (x) estar√°s tras {t} horas de viaje sin detenerte?" },
                { t: "Asalto al Blindado", d: "El furg√≥n blindado que vamos a asaltar se encuentra ahora mismo en la baliza {x0}. Se mueve a una velocidad constante de {v} m/s hacia nuestra posici√≥n de emboscada.", p: "¬øCu√°l ser√° su posici√≥n (x) exacta tras {t} segundos de recorrido?" },
                { t: "Huida por Autopista", d: "Tu coche de fuga inici√≥ la huida en el km {x0}. Mantienes una velocidad de crucero de {v} km/h para no levantar sospechas mientras te alejas del lugar del crimen.", p: "¬øQu√© marca kilom√©trica (x) alcanzar√°s tras {t} horas de conducci√≥n?" }
            ],
            3: [
                { t: "Encuentro de Bandas Rivales", d: "La banda de 'Los Lobos' viene desde el este a {v1} m/s. Tu equipo sale desde el oeste, situados a una distancia total de {dist} metros de ellos, movi√©ndose a {v2} m/s para el choque frontal.", p: "¬øEn cu√°ntos segundos (t) se producir√° el encuentro entre ambos grupos armados?" },
                { t: "Persecuci√≥n Doble", d: "Un sopl√≥n huye a {v1} m/s. T√∫ sales en su busca desde una posici√≥n retrasada {dist} metros, acelerando a una velocidad constante de {v2} m/s.", p: "¬øCu√°nto tiempo (t) tardar√°s en darle alcance antes de que llegue a la comisar√≠a?" },
                { t: "Intercepci√≥n Policial", d: "Dos patrullas de √©lite se acercan desde extremos opuestos de un puente de {dist} metros de largo. La patrulla A va a {v1} m/s y la B a {v2} m/s para cerrarte el paso.", p: "¬øEn qu√© segundo (t) se cruzar√°n ambas patrullas atrap√°ndote en medio?" }
            ]
        };

        function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

        function generateQuestion(lvl) {
            const list = scenarioGen[lvl];
            // Asegurar que no repetimos el mismo enunciado en las 7 preguntas
            let idx;
            do {
                idx = Math.floor(Math.random() * list.length);
            } while (state.usedScenarioIndices.includes(idx) && state.usedScenarioIndices.length < list.length);
            
            state.usedScenarioIndices.push(idx);
            if (state.usedScenarioIndices.length >= list.length) state.usedScenarioIndices = [];

            const raw = list[idx];
            let ans, options, dist, time, x0, v, t, v1, v2;

            if (lvl === 1) {
                dist = Math.floor(Math.random() * 50) + 40;
                time = Math.floor(Math.random() * 5) + 5;
                ans = (dist / time).toFixed(1);
                return {
                    title: raw.t,
                    desc: raw.d.replace("{dist}", dist).replace("{time}", time),
                    prob: raw.p,
                    ans: ans,
                    unit: "m/s",
                    options: shuffle([ans, (ans * 1.3).toFixed(1), (ans - 0.8).toFixed(1), (ans * 0.7).toFixed(1)])
                };
            } else if (lvl === 2) {
                x0 = Math.floor(Math.random() * 80) + 20;
                v = Math.floor(Math.random() * 20) + 20;
                t = Math.floor(Math.random() * 4) + 2;
                ans = (x0 + v * t).toString();
                return {
                    title: raw.t,
                    desc: raw.d.replace("{x0}", x0).replace("{v}", v).replace("{t}", t),
                    prob: raw.p,
                    ans: ans,
                    unit: "",
                    options: shuffle([ans, (parseInt(ans) + 20).toString(), (parseInt(ans) - 15).toString(), (x0 + v * (t + 1)).toString()])
                };
            } else {
                dist = Math.floor(Math.random() * 400) + 300;
                v1 = Math.floor(Math.random() * 10) + 15;
                v2 = Math.floor(Math.random() * 10) + 25;
                ans = (dist / (v1 + v2)).toFixed(1);
                return {
                    title: raw.t,
                    desc: raw.d.replace("{dist}", dist).replace("{v1}", v1).replace("{v2}", v2),
                    prob: raw.p,
                    ans: ans,
                    unit: "s",
                    options: shuffle([ans, (ans * 1.4).toFixed(1), (ans - 1.5).toFixed(1), (dist / v2).toFixed(1)])
                };
            }
        }

        function showScreen(id) {
            ['screen-auth', 'screen-levels', 'screen-game', 'screen-result'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }

        function goToLevels() {
            const val = document.getElementById('alias-input').value.trim();
            if (!val) return;
            state.alias = val;
            document.getElementById('display-alias').innerText = state.alias;
            showScreen('screen-levels');
        }

        function startLevel(l) {
            state.currentLevel = l;
            state.questionIndex = 1;
            state.lives = 3;
            state.usedScenarioIndices = [];
            showScreen('screen-game');
            updateLives();
            loadQuestion();
        }

        function updateLives() {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            for(let i=0; i<3; i++) {
                const s = document.createElement('span');
                s.className = `heart ${i < state.lives ? 'text-red-500' : 'lost-heart'}`;
                s.innerHTML = '‚ò†';
                container.appendChild(s);
            }
        }

        function loadQuestion() {
            state.isAnswering = false;
            document.getElementById('feedback').classList.add('hidden');
            
            const config = generateQuestion(state.currentLevel);
            state.currentData = config;

            document.getElementById('level-label').innerText = `OPERATIVO NIVEL ${state.currentLevel}`;
            document.getElementById('question-progress').innerText = `Misi√≥n ${state.questionIndex} / 7`;
            document.getElementById('crime-title').innerText = config.title;
            document.getElementById('crime-desc').innerText = config.desc;
            document.getElementById('math-problem').innerText = config.prob;

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            config.options.forEach(opt => {
                const b = document.createElement('button');
                b.className = "option-btn py-4 px-6 rounded-xl font-bold text-sm text-slate-300 transition-all hover:text-white";
                b.innerText = `${opt} ${config.unit}`;
                b.onclick = () => checkAnswer(opt);
                grid.appendChild(b);
            });
        }

        function checkAnswer(val) {
            if (state.isAnswering) return;
            state.isAnswering = true;

            const feedback = document.getElementById('feedback');
            const fText = document.getElementById('feedback-text');
            const cText = document.getElementById('consequence-text');
            const fIcon = document.getElementById('feedback-icon');
            
            feedback.classList.remove('hidden');

            if (val === state.currentData.ans) {
                fIcon.innerHTML = 'üí∞';
                fText.innerText = "√âXITO EN EL OPERATIVO";
                fText.className = "text-green-500 font-bold uppercase tracking-widest text-sm";
                cText.innerText = "Has burlado la seguridad. El material ha sido entregado sin sospechas.";
                feedback.className = "mt-8 p-6 rounded-2xl border border-green-900/40 bg-green-950/40 animate-slide";
            } else {
                state.lives--;
                updateLives();
                fIcon.innerHTML = 'üö®';
                fText.innerText = "FALLO DE C√ÅLCULO";
                fText.className = "text-red-500 font-bold uppercase tracking-widest text-sm";
                
                const pun = [
                    "Has tenido que tirar la mitad de la mercanc√≠a para poder escapar.",
                    "La polic√≠a ha tomado fotos de tu rostro. Tu reputaci√≥n ha ca√≠do.",
                    "Perdiste el contacto con el equipo de apoyo. P√©rdidas econ√≥micas graves."
                ];
                cText.innerText = pun[Math.floor(Math.random() * pun.length)];
                feedback.className = "mt-8 p-6 rounded-2xl border border-red-900/40 bg-red-950/40 animate-slide";

                if (state.lives <= 0) {
                    document.getElementById('next-btn').onclick = () => finish(false);
                    return;
                }
            }
        }

        function nextStep() {
            state.questionIndex++;
            if (state.questionIndex > state.maxQuestions) {
                finish(true);
            } else {
                loadQuestion();
            }
        }

        function finish(win) {
            showScreen('screen-result');
            const icon = document.getElementById('result-visual');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');
            const jailCard = document.getElementById('result-jail-card');
            const successCard = document.getElementById('success-card');

            if (win) {
                icon.innerHTML = 'üè¢';
                title.innerText = "CAPO DE LA RED";
                title.className = "text-4xl font-black mb-4 uppercase tracking-tighter text-green-500";
                desc.innerText = `Incre√≠ble, ${state.alias}. Has completado todas las misiones y ahora controlas el sector.`;
                successCard.classList.remove('hidden');
                jailCard.classList.add('hidden');
                document.getElementById('secret-code').innerText = Math.random().toString(36).substring(2, 10).toUpperCase();
            } else {
                icon.innerHTML = '‚õìÔ∏è';
                title.innerText = "OPERATIVO ABORTADO";
                title.className = "text-4xl font-black mb-4 uppercase tracking-tighter text-red-500";
                desc.innerText = `Te han cazado, ${state.alias}. Tus errores te han llevado directo a la celda.`;
                successCard.classList.add('hidden');
                jailCard.classList.remove('hidden');
                
                const jails = [
                    { t: "18 meses", d: "M√≥dulo de Delincuencia Menor", r: "Hurtos reiterados y alteraci√≥n del orden p√∫blico." },
                    { t: "15 a√±os", d: "Prisi√≥n de Alta Seguridad", r: "Tr√°fico internacional de estupefacientes y asalto a mano armada." },
                    { t: "CADENA PERPETUA", d: "Penal de M√°xima Seguridad (Aislamiento)", r: "Direcci√≥n de organizaci√≥n criminal y alta traici√≥n." }
                ];
                const j = jails[state.currentLevel - 1];
                document.getElementById('recluso-id').innerText = Math.floor(1000 + Math.random() * 9000);
                document.getElementById('jail-time').innerText = j.t;
                document.getElementById('jail-destination').innerText = j.d;
                document.getElementById('jail-reason').innerText = j.r;
            }
        }
    </script>
</body>
</html>
